# Deploying inxinfo-auth-service (Backend) on Render with PostgreSQL

This guide covers hosting the **backend** (inxinfo-auth-service) on Render as a Web Service with a **PostgreSQL** database.

---

## 1. Prerequisites

- **Repo**: inxinfo-labs / inxinfo-auth-service (or the repo that contains this backend)
- **Backend**: Java 21, Spring Boot 4, Maven, runs as **monolith** (app-runner) with context path `/api`
- **Database**: PostgreSQL (Render Postgres or your existing Postgres)

---

## 2. Option A: Deploy with Blueprint (recommended)

If your repo root contains `render.yaml`:

1. In [Render Dashboard](https://dashboard.render.com), go to **Blueprints** and **New Blueprint Instance**.
2. Connect the repo **inxinfo-auth-service** (or the repo that contains it).
3. If the backend is in a subfolder (e.g. monorepo), set **Root Directory** to `inxinfo-auth-service`.
4. Render will create:
   - A **PostgreSQL** database (e.g. `inxinfo-db`) with database name `inxinfo`
   - A **Web Service** (Docker) named `inxinfo-auth-service` that builds from the Dockerfile and gets `DATABASE_URL` from the database
5. After the first deploy, in the **Web Service → Environment**, set any **sync: false** variables:
   - `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET` (for Google login)
   - `MAIL_USERNAME`, `MAIL_PASSWORD` (for email / forgot password)
   - `JWT_SECRET` (or leave the one generated by the blueprint)
   - `RAZORPAY_KEY_ID`, `RAZORPAY_KEY_SECRET` (if you use payments)
6. Redeploy after adding env vars.

Your backend will be at: **https://inxinfo-auth-service.onrender.com** (or the URL shown in the dashboard).  
API base URL for the frontend: **https://inxinfo-auth-service.onrender.com/api**

---

## 3. Option B: Manual setup (no Blueprint)

### 3.1 Create PostgreSQL database

1. Render Dashboard → **New** → **PostgreSQL**.
2. Name: e.g. `inxinfo-db`, Plan: **Free**, Region: **Oregon** (or same as your frontend).
3. Create the database and note the **Internal Database URL** (postgres://...).

### 3.2 Create Web Service (Docker)

1. Render Dashboard → **New** → **Web Service**.
2. Connect the repo that contains **inxinfo-auth-service**.
3. **Root Directory**: set to the folder that contains `Dockerfile` and `pom.xml` (e.g. `inxinfo-auth-service` if in a monorepo).
4. **Runtime**: **Docker**.
5. **Build**: Render will use the Dockerfile in the root directory.
6. **Instance type**: Free (or Starter for always-on).

### 3.3 Environment variables

In the Web Service → **Environment**, add:

| Key | Value / source |
|-----|----------------|
| `DATABASE_URL` | **From Render Postgres**: Dashboard → your Postgres → **Connect** → **Internal Database URL** (copy the full `postgres://...` string). Or paste your own Postgres URL. |
| `SPRING_PROFILES_ACTIVE` | `prod` |
| `JWT_SECRET` | A long random string (e.g. generate with `openssl rand -base64 32`) |
| `FRONTEND_URL` | `https://www.inxinfo.com` (or your frontend URL) |
| `GOOGLE_CLIENT_ID` | Your Google OAuth client ID |
| `GOOGLE_CLIENT_SECRET` | Your Google OAuth client secret |
| `MAIL_USERNAME` | Email for sending (e.g. Gmail) |
| `MAIL_PASSWORD` | App password for that email |
| `RAZORPAY_KEY_ID` | (optional) Razorpay key |
| `RAZORPAY_KEY_SECRET` | (optional) Razorpay secret |

**Important**: Use the **Internal** Database URL when the database and the Web Service are on Render (same region). That way the app uses Render’s private network and the `postgres://` URL is automatically parsed by the backend into a JDBC connection. If your password contains special characters (e.g. `@`, `#`), ensure it is URL-encoded in the connection string.

### 3.4 Using your own existing PostgreSQL

If you already have a Postgres instance (e.g. created outside Render):

1. Get the connection URL in the form `postgres://user:password@host:5432/dbname` (or `postgresql://...`).
2. Set **DATABASE_URL** in the Web Service environment to that URL.
3. Ensure the database is reachable from Render (allow Render’s IPs or use a public URL if your provider supports it).

---

## 4. Frontend configuration

Point the frontend to the backend API:

- In the **frontend** (inxinfo-user-portal) on Render, set:
  - **REACT_APP_API_URL** = `https://<your-backend-service>.onrender.com/api`
- Example: `https://inxinfo-auth-service.onrender.com/api`
- If you use a custom domain for the backend, use that base URL + `/api`.

Redeploy the frontend after changing **REACT_APP_API_URL**.

---

## 5. CORS

The backend already allows:

- `https://www.inxinfo.com`
- `https://inxinfo.com`
- `https://inxinfo-user-portal-1.onrender.com`
- `http://localhost:3000`

If you use another frontend URL, add it in **CorsConfig** in the backend and redeploy.

---

## 6. After deploy

- **Health**: Open `https://<backend-url>/api/swagger-ui.html` to confirm the API is up (and that context path is `/api`).
- **Database**: The app uses `spring.jpa.hibernate.ddl-auto=update`, so tables are created/updated on first run. No manual SQL is required for the default schema.
- **Logs**: Use the **Logs** tab of the Web Service on Render to debug startup or DB connection issues.

---

## 7. Summary

| Item | Value |
|------|--------|
| Backend API base | `https://inxinfo-auth-service.onrender.com/api` |
| Frontend env | `REACT_APP_API_URL=https://inxinfo-auth-service.onrender.com/api` |
| Database | PostgreSQL (Render or your own), URL in `DATABASE_URL` |
| Profile | `prod` (uses `application-prod.yml` and Render datasource config) |

Your frontend (www.inxinfo.com / inxinfo-user-portal) can stay as-is; only **REACT_APP_API_URL** needs to point to this backend.
